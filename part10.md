## ビジネスメタをオントロジーで書く - Part 10

### TTLファイルとトリプルストアは何が違うのか
前回では、RDFをグラフデータベースで持てればデータが増えても安心ではないか、という発想でTTLファイルをFusekiに読ませ、これをGemini CLIに直接SPARQLで突かせるに至り、この組み合わせを「即席GraphRAG」と表現した。

しかし考えてみれば、これは安心か否か、というよりそもそも物理量の限界による必然であろう。この先の展開の前提としてこの点を確認しておこう。

RDFデータのサイズは一般的にはトリプル数で測るようである。トリプルとは前回触れたように、主語 (subject) - 動詞 (predicate) - 目的語 (object) の組み合わせである。クエリ文では s, p, o と略したりもする。

Northwind RDFの今のところのトリプルカウントは730である。これはTTLファイルでもFusekiのRDFグラフでも同じだ。しかしここにGenAIを持ってきたとき、TTLファイルを読ませるのと、SPARQLクエリを投げさせるので何が違うのか。

先に結論からいえば、たかだか730トリプル程度のRDFをわざわざトリプルストアに入れる必要はないだろう。現状のTTLファイルのサイズは40KBで、GenAIにとってこの程度のテキスト全体を読んで構造を把握するのは、論文をサマったりするのと同様に造作もない。

しかしTTLファイルのサイズが例えば100倍、40MBなどになると、これはGenAIにとっても大変なのではないか。トリプル数も単純に100倍すると7万3千である (実際はAnnotation Propertyで抽象化されているビジネスメタデータはそんなに増えないが)。

現状のRDFトリプルの元となったNorthwindのRDBテーブル数は13個なので、それも100倍すると1300個になる。中小企業の基幹系ならそのくらいになるのではないか。この構造全体をテキストベースのTTLファイルで把握して、ユーザからのアドホックな質問に答えるというのは、技術的には可能なのだろうが経済合理性としては疑問が生ずるだろう。

一方トリプルストアというと、調べてみれば世の中にはbillionトリプル越えもザラにあるようだ。メタデータがそんな数になることはない (データインスタンスまでRDFトリプルにするなら別だが) し、RDFの書き始めはTTLファイルとしても、早々にトリプルストアで管理するのが基本となる (慣れていれば最初からトリプルストアという選択も当然あるだろう)。

さて、ここで次の疑問が湧いてくる。SPARQLでトリプルストアを操作するにしても、そのRDFを書いた本人でもなければ (他人はもちろんGenAIにも) その中身は最初は分からない訳で、その場合どうやって「全体を把握」するのだろうか。TTLファイルなら考える必要も無かったのだが。

しかしこういう疑問は今やGenAIに尋ねれば一発で答えが出る。まこと便利な世の中である。

### 段階的探索
複数のGenAIに訊いてみたが、回答はどれもまあ大体同じようなものである。しかし驚きなのは「初見でSPARQLを書くなんて生成AIでも出来る訳ありませんよね？」という認識がそれらの中ですでに前提として確立されている、つまりRDFの「メタデータ」を自らSPARQLで取ってきて、それらをコンテキストとして保持し、然るにユーザのリクエストに応じたSPARQLを書く、という手順を既に知っているのである。何という進歩だろうか！

グラフデータのメタ (ここではメタデータをグラフで書いているので「メタのメタ」となる) のうち、以下がベーシックなものであるようだ。
- トリプル数 - 最初にRDFグラフの大きさを測る
- クラスとプロパティ - 数えた結果を基に主語・述語のサンプリング
- プレフィクスとネームスペース - サンプリング結果からプレフィクスと名前空間を抽出

更に必要に応じて以下のようなメタも取得するらしい。
- 利用頻度 - クラスとプロパティの出現回数を数える
- プロパティのドメインとレンジ - ここで扱っているのはメタデータなので取得は大変ではないが、データインスタンスを含むグラフの場合は統計的に推測することもある

しかし考えてみればこれはLLMに限ったことではなく、人間とて同じである。思えばこれまではRDFをGenAIに書かせるばかりだったが、ここからはグラフデータの使い方、もっと言えば読み方の話になる。そこには何がどのように書かれているのか、あることを知りたいとき、どんなレスポンスを期待すべきなのか、そのレスポンスを得るためにはどんなクエリを書けばよいのか。次回はこのようなこのような探索プロセスそのものを、RDFグラフ管理の当事者の視点で深堀りしよう。

([Part11につづく](part11.md))

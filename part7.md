## ビジネスメタをオントロジーで書く - Part 7

### スキーマと概念をどうつなぐか

さて前回では、オントロジーファイルをNeo4jに読ませることには成功したものの、「素の」スキーマの部分と意味的構造の部分とが分離したビューになってしまった。早速のび太よろしくGeminiに助けを求める。Geminiドラえもんが出した答えは以下である。

1. 新しい語彙の導入： ブール値で真、と書く代わりとなる 「エンティティ概念を持つ」 「属性概念を持つ」 という語彙をオントロジーに加える

```
@prefix meta: <http://example.org/meta#> .

meta:hasEntityConcept rdf:type owl:ObjectProperty .
meta:hasAttributeConcept rdf:type owl:ObjectProperty .
```

2. スキーマ要素に 「概念を持つ」 記述の追加： 「アノテーション・プロパティの値が真」 をやめて、代わりに 「アノテーション・プロパティを持っている」 という表現に変える

```turtle
# 変更前:
nw:Products rdf:type owl:Class ;
  rdfs:label "Products" ;
  ent:Products "true"^^xsd:boolean .

# 変更後:
nw:Products rdf:type owl:Class ;
  rdfs:label "Products" ;
  meta:hasEntityConcept ent:Products .
```
### オントロジーは繋がるか？

Geminiに前回のファイルを修正してもらい、[繋がった (筈の) ファイル](https://github.com/Yoshiyuki-iasa/northwind/blob/main/northwind_ontology_pt7.ttl)ができたら、[前回同様の手順で](part6.md)Neo4jにインポートしてみる。ただしプレフィックスがひとつ増えているので注意。
```
CALL n10s.nsprefixes.add("meta", "http://example.org/meta#");
```
インポート出来たら、例の 「`n.name`をセットする」 コマンド、続いて 「孤立も含めて全ノードをリレーション付きで表示」 コマンドを流すと、今度は器の中の納豆の如き、一塊の丸と線が表示された (こぼれた納豆粒のような孤立ノードもちらほら見えるが細かいところは後回し)。これは 「オントロジーで書かれ、グラフデータとして記録されたメタデータ」 と呼べるのではないか。実は誰もが既にやっていることかも知れないし、逆に何か根本的に間違たやり方なのかも知れない。しかし少なくとも 「実際に動かせる」 というところがミソである。しかもタダで誰でも試すことができる。

試しに「離れてそうなふたつの概念同士の関係」などというのを可視化出来たら面白そうと思い、いろいろ試してみたが、このNeo5jの独自クエリ言語であるCYPHERは相当難しく、これを書くのもGeminiを頼り切るのみである。「製品IDと従業員IDの繋がり」を可視化するのにこんなに長く複雑なCYPHERが要る。これを自力で書けるようになるための学習コストは如何ほどだろうか。
```
MATCH p = (a {name: 'EmployeeID Concept'})-[*..10]-(b {name: 'ProductID Concept'})
WHERE ALL(r IN relationships(p) WHERE (type(r) <> 'rdfs__subPropertyOf' AND type(r) <> 'rdfs__range'))
RETURN p
ORDER BY length(p)
LIMIT 1
```

### ノードの色分け

Neo4jブラウザのグラフィック表示は非エンジニア向けではないにしても、 「丸が全部同じ色」 というのはいただけない。しかしこれは簡単に修正できる。`:STYLE`と打つとスタイルシートが表示されるので、右側のアイコンでダウンロードし、`Resource`に掛かっている設定を以下のようにコメントアウトしてアップロードするだけである。
```
/* node.Resource {
  color: #b3ee55;
  size: 25px;
} */
```
これだけで見た目は派手にはなるが、解りやすくなったとは言い難いので、いっそのこと (某イベントのマスコットキャラっぽく) DBスキーマ (`Class`, `ObjectProperty`, `DatatypeProperty`)を青 (`#0095d9`)、意味構造 (`AnnotationProoety`) を赤 (`#e60033`) にして上げなおしてみよう 

線が集中している緑の丸はDBスキーマのデータ型で、左クリックでDismissしてしまえば表示がless busyになる。

簡単に言えば青が物理メタ、赤がビジネスメタである。物理メタは元を辿ればNorthwindのDDLで、ここに至るまでその構造には (対応するAnnotation Propertyとの繋がり以外) 手は一切加えられていない。一方赤い方はAIの手を借りたにせよ、本質的には人間の意図を反映している。

言い換えれば青はボトムアップ、赤はトップダウンである。現状把握なら青が、将来構想なら赤が先行する。ビジネス的には、青に先行する赤が常に多かれ少なかれ存在するのが理想であろう。赤がない青が大量にある、という状態は一時的には許容され得るだろうが、いつまで経ってもそのままなのは最悪である。しかしそれが多くの組織の実態でもあり、そうと分かればやるべきことは誰にとっても明らかである。

そもそも負債なのか資産なのかわからないようなものが大量にある状況が、ビジネスにとって良いわけがない。ライフサイクルを終えて用済みなら 「データ負債」 としてさっさとwrite off (あるいはcarve out) するし、新しく獲得した 「データ資産」 なら、速やかにビジネスメタを振って稼ぎに出てもらわなければならない。

赤い部分に書き加えられるものは他にもいろいろあるが、次回ではその中でも使う機会が多そうななものを取り上げてみる。

(Part8につづく)

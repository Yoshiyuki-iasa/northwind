## ビジネスメタをオントロジーで書く - Part 21

### 考慮点と解決

R2RMLやOntopに触れて、「記号と意味は別物である」という原理原則が揺るぎないものであることを痛感する。リアルビジネスにおいて、物理テーブル (＝記号) は大げさに言えば大抵意味不明だし、ビジネスの世界表現もハイレベル (MVVや中計、社規社則、財務諸表など) あるいは暗黙知にしか存在しない。しかもそれらは往々にして全体のごく一部であり、相互関連は不明確、ましてやシステムのデータモデルとの整合などまず期待できないだろう (自動クラス抽出でスパゲッティ・グラフが出来る or スカスカのが出来て手で書いた方が早くて安い。前者は欧米、後者は国内のあるあるなのではないか)。

「別物」というのは、ここで片方をもう一方に寄せる、といった考えは捨てる、ということだ。物理テーブルはすでに存在し、システム入替まではそのままである。一方ビジネス世界の記述はまだ存在しないのでこれから作るが、その際物理テーブルがどうなっているかは参考にこそすれ「丸写し」はしない。あくまで概念の名前と意味が大事である。

そしてR2RMLでマッピングである。ただし無理にマッピングはしない、つまりマッピングの数自体をKPIにはしない。意味がなければマッピングも不要でだし、意味があるのにテーブルの設計が悪くてマッピング出来ないなら、システム入替・リファクタリングまで待つか、出来そうならビューやETLなどでスキーマ変換する。そして「意味」と「記号」とはライフサイクルが異なるので、どちらかが先に変わればマッピングを修正する。そうやって全体の論物整合性を維持・向上していく。

これらはデータソース側の構成及び運用である。要素は「本番物理テーブル」「R2RMLマッピング」「RDFトリプル」の3点セット、実にシンプルで、大きなストレージも複雑なETLも不要だ。

では、これをどう消費・活用に繋げるか、例えば「チャットUIで問いに対し結果を返す」みたいなサービスを組む場合、どんな考慮が必要になるだろうか。

**考慮店1 Ontopに与えるオントロジー** - Ontop Reasonerは推論とSQLマッピングを行うのにオントロジーが必要だが、その際参照するのはテキスト形式のシリアライゼーションであり、RDFトリプルストアに保存されたオントロジーを直接参照することは出来ない。

だからといってRDFトリプル全体をシリアライズして与えるのも、推論に無関係なリソースも大量に含まれてしまい非効率だし、それならRDFトリプルストアに推論に使えるオントロジーしか書かなければ (例えばチュートリアルのサンプルには`rdfs:label`さえ付いていない) 済むのかというと、それではLLMがプロンプトからSPARQLを生成する際のコンテキスト、つまりメタデータとしての役に立たない。

つまり「推論用にはlean、プロンプトのコンテキストとしてはrich」というトレードオフである。

**考慮点2 アクセス制御** - 権限外のデータが返されるようでは困る。これはいうまでもない。

これらの課題の解決としては以下のようなアイデアがあるだろう。

**解決1 Ephemeral TBox** - Ephemeralとは要は「使い捨て」で、IT界隈ではawsのセッションマネージャで使われる"ephemeral key"などで目にする表現である。TBox (Terminology Box) とは「概念定義」を指すオントロジー用語である (対義語はABox (Assertion Box) で「具体的事実」)。つまりTBoxはメタデータ、ABoxは実データだ。「メタデータ」とか「オントロジー」とか書くと長いので、ここでは短くTBoxという表現を使っている。

Ephemeral TBoxは、オンデマンドでGenAIによってRDFトリプルから動的に生成されるオントロジーのシリアライゼーションである。Ontopによる推論とSQL生成に必要な範囲と種類のオントロジーを抜き出す (例えば`rdfs:label`は推論に関与しないのでEphemeral TBoxには書かれない)。

また、セキュリティについても、RDFトリプルにACLを持たせておけば、権限のないクラスなどを除外し、クエリ生成を物理的に制限できる。

**解決2 Serverless Ontop Reasoner** - TBoxが使い捨てなので、Ontop Reasonerもコンテナなどで使い捨てである。セキュリティ的にもユーザセッションごとに起動して、他のユーザセッションのSQLクエリ生成プロセスから隔離する。セッションが終わればコンテナは自動削除される。

### 絵にするとこうなる

それではこれらがどう振舞うのかだが、ここはGenAIの出番であろう。結果見た目はあまりパッとしないが、4段階の動きのイメージは伝わるのではないか。

**第1段階「解釈」** - 真ん中の"Metadata Store"はRDFトリプル、右側は上で"Ephemeral TBox"と呼んだものである。ユーザプロンプトの意図を、そのコンテクストとしてRDFトリプルストア内のオントロジーを参照し解釈する。また、SPARQL-SQL変換に関係ありそうな部分をシリアライズして切り出す。

![Phase 1](/media/p21fig1.png)

**第2段階「SPARQL生成」** - G3nAIによる解説は「AIエージェントが論理的なクエリ（SPARQL）を組み立てるフェーズ」だそうである (AIエージェントはGenAIの創作だが)。SPARQLを書ける「ヒト」は少ないが、大抵のLLMはSPARQLが書ける。使わないのは損である。実際には、ユーザとLLMで意図の解釈が一致するまで、チャットUI上でのやり取りが何ターンか繰り返されるのだろう。

![Phase 2](/media/p21fig2.png)

**第3段階「SPARQL->SQL変換」** - 真ん中に"Ontop Endpoint"が登場した。これの裏側でセッションごとに一時生成されたOntop Reasonerコンテナが推論+SQL生成を行う。図中にはODBAファイル (R2RMLマッピング本体) はアーティファクトとして登場していないが、当然このコンテナによって参照されている。

![Phase 3](/media/p21fig3.png)

**第4段階「回答生成」** - GenAI曰く「AIエージェントがデータを受け取り、ユーザーに分かりやすい回答（テキスト＋グラフ）として提示するフェーズ」。第1段階とこの段階の「AIエージェント」は、異なるスキルを持つ別人(?)かも知れない。

![Phase 4](/media/p21fig4.png)

### 今は無理でも何時かは…

これのどこが良さそうかというと、
- 構成も動作原理もシンプルで明快 - ストレージコストが低い。ブラックボックスが最小限。
- RDFトリプルが知的財産としてポータブル - 国際標準かつ製品非依存なので最小コストで維持可能。
- 論物完全分離 - どちらの変化もマッピングの変更のみで対応可能。

といったところか。難しいのはOSSサポートなどの実装面はさて置き、
- RDF / R2RMLの学習コストが非常に高そう

のほぼ一点に絞られるだろう。しかしこれは「見方・捉え方」の問題ではないか、と強く感じる。学ぶべき「知識の機械可読な構造的記述」は (恐らく) 「AIに奪われない人間の最後の仕事」のひとつだ。コスト (時間) が掛かる、といっても、記述された知識のライフサイクルは「事業と同じ」である。つまりマインドセットやメンタルモデル、そしてリテラシーといった「企業のcultureやphilosophyの問題」なのだ。そしてそれは「GenAIで代替不可能」なのは言うまでもない。そこに合点がいけば、あとはフォーマルなJob Descriptionに落として (ここはGenAIが役に立つ)、然るべきレベルで機関決定するだけである。

チュートリアル前半ですでにいろいろと気づきや思いつきがあり、忘れる前に急いでまとめてみた。次回はチュートリアル後半だが、ここでも「記号と意味は別物」というR2RMLの驚くべき「本性」を目の当たりにするのであった。

([Part22に続く](part22.md))

